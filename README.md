# telegram-channel-bot-cloudflare

Telegram bot on Cloudflare, publish messages in Telegram channels.

## Workers

Cloudflare workers prefix: `tcb-`.

### tcb-flickr-oauth

Provide OAuth 1a service for Flickr APIs.

Route: `${DOMAIN_NAME}/flickr/oauth`.

### tcb-flickr-polling

Polling Flickr's API to get latest photos.

## KV

KV name: `tcb`.

To setup KV, you need to provide following keys:

- `flickr.consumer.key`: Flicker app's key
- `flickr.consumer.secret`: Flicker app's secret
- `telegram.bot_token`: Telegram bot's token
- `telegram.error_reporting_chat_id`: The Telegram chat to report worker errors
- `telegram.photo_channel_id`: The Telegram channel to send photo information messages

The following keys will be generated by workers automatically:

- `flickr.oauth.token`
- `flickr.oauth.token_secret`
- `flickr.oauth.verifier`
- `worker.polling.running_status_id`

## D1

D1 database name: `tcb`.

To setup D1, you need to prepare two tables.

### tcb.actions

- `action`: text (primary)
- `timestamp`: integer

### tcb.photos

- `id`: integer (primary)
- `secret`: text
- `owner`: text
- `is_public`: integer
- `is_published`: integer (default: 0)

## Durable Objects

It's not necessary to prepare for DO.

An DO will be generated at the first time run, and the object ID will be stored in KV: `worker.polling.running_status_id`.
